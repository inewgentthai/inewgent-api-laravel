<?php

class ApiStoreSettingControllerTest extends ApiTestCase
{
    public function testGetShowHaveSettingSuccess()
    {

        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->cacheRepository->expects($this->once())->method('get')->will($this->returnValue(null));

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = '[{"store_id":111,"meta":"{\"config\":{\"upload_allowed\":[\"image\\\/jpeg\",\"image\\\/gif\",\"image\\\/png\"],\"invoice_prefix\":\"INV-{{year}}-{{number}}\",\"timezone\":\"Asia\\\/Bangkok\",\"google_analytics\":\"\",\"price_hide_text\":\"Please contact shop\",\"prepare_shipping\":\"0\"},\"currency\":{\"currency_auto\":\"1\",\"default\":\"THB\",\"symbol\":\"\\u0e3f\",\"html_with_currency\":\"{{amount}} &#xe3f; THB\",\"html_without_currency\":\"{{amount}} \\u0e1a\\u0e32\\u0e17\",\"email_with_currency\":\"{{amount}} \\u0e3f THB\",\"email_without_currency\":\"{{amount}} \\u0e3f\"},\"language\":{\"list\":[\"th\"],\"default\":\"th\",\"admin\":\"th\",\"system\":[\"th\"]},\"template\":{\"admin\":\"default\",\"front\":\"shindesign\"},\"quota\":{\"product_sku\":\"10\",\"pages\":\"10\",\"collection\":\"10\",\"category\":\"10\",\"blogs\":\"10\",\"storage\":\"504748367\",\"language\":\"10\",\"promotion\":\"10\"},\"paging\":{\"product\":\"12\",\"category\":\"4\",\"collection\":\"12\"},\"policy\":{\"refund\":\"My Policy refund\",\"privacy\":\"My policy privacy\",\"terms\":\"My terms\"},\"unit\":{\"length\":\"cm\",\"system\":[\"metric\",\"imperial\"],\"default\":\"metric\",\"weight\":\"kg\"},\"print\":{\"receipt\":\"true\",\"order\":\"true\",\"tracking\":\"true\",\"logo\":\"1\",\"sender\":\"true\",\"receiver\":\"true\",\"showlogo\":\"true\"},\"shipping\":{\"instock\":\"7\",\"preorder\":\"15\"}}","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = json_decode($mock, true);

        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue($mock));

        $crawler = $this->client->request('GET', 'api/store/setting/111', array());
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testGetShowNoHaveSetting()
    {

        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->cacheRepository->expects($this->once())->method('get')->will($this->returnValue(null));

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = null;
        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue($mock));

        $mock = '
[{"id":10,"group":"config","key":"upload_allowed","value":"[\"image\/jpeg\",\"image\/gif\",\"image\/png\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":11,"group":"config","key":"invoice_prefix","value":"INV-{{year}}-{{number}}","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":12,"group":"currency","key":"currency_auto","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":13,"group":"language","key":"list","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":14,"group":"language","key":"default","value":"th","title":"Default Front Language","desctiption":"Default Front Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":15,"group":"language","key":"admin","value":"th","title":"Default Admin Language","desctiption":"Default Admin Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":16,"group":"template","key":"admin","value":"default","title":"Default Front Template","desctiption":"Default Front Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":17,"group":"template","key":"front","value":"shindesign","title":"Default Admin Template","desctiption":"Default Admin Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":18,"group":"quota","key":"product_sku","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":19,"group":"quota","key":"pages","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":20,"group":"quota","key":"collection","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":21,"group":"quota","key":"category","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":22,"group":"currency","key":"default","value":"THB","title":"Default Currency","desctiption":"Default Currency","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":23,"group":"quota","key":"blogs","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":26,"group":"quota","key":"storage","value":"504748367","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":29,"group":"currency","key":"symbol","value":"\u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":31,"group":"paging","key":"product","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":32,"group":"paging","key":"category","value":"4","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":33,"group":"paging","key":"collection","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":34,"group":"language","key":"system","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":35,"group":"config","key":"timezone","value":"Asia\/Bangkok","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":37,"group":"config","key":"google_analytics","value":"","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":38,"group":"currency","key":"html_with_currency","value":"{{amount}} &#xe3f; THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":39,"group":"currency","key":"html_without_currency","value":"{{amount}} \u0e1a\u0e32\u0e17","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":40,"group":"currency","key":"email_with_currency","value":"{{amount}} \u0e3f THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":41,"group":"currency","key":"email_without_currency","value":"{{amount}} \u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":42,"group":"config","key":"price_hide_text","value":"Please contact shop","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":43,"group":"policy","key":"refund","value":"My Policy refund","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":44,"group":"policy","key":"privacy","value":"My policy privacy","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":45,"group":"policy","key":"terms","value":"My terms","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":46,"group":"unit","key":"length","value":"cm","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":47,"group":"unit","key":"system","value":"[\"metric\",\"imperial\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":48,"group":"unit","key":"default","value":"metric","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":49,"group":"unit","key":"weight","value":"kg","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":57,"group":"print","key":"receipt","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":58,"group":"print","key":"order","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":59,"group":"print","key":"tracking","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":60,"group":"quota","key":"language","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":61,"group":"quota","key":"promotion","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":62,"group":"print","key":"logo","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":64,"group":"print","key":"sender","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":65,"group":"print","key":"receiver","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":66,"group":"print","key":"showlogo","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":67,"group":"config","key":"prepare_shipping","value":"0","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":68,"group":"shipping","key":"instock","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":69,"group":"shipping","key":"preorder","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"}]';
        $mock = json_decode($mock);

        $this->storesettingRepository->expects($this->once())->method('getDefaultSetting')->will($this->returnValue($mock));

        $crawler = $this->client->request('GET', 'api/store/setting/111', array());
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testGetShowNoHaveMetaData()
    {

        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->cacheRepository->expects($this->once())->method('get')->will($this->returnValue(null));

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = '[{"store_id":111,"meta":"","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = json_decode($mock, true);

        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue($mock));

        $mock = '
[{"id":10,"group":"config","key":"upload_allowed","value":"[\"image\/jpeg\",\"image\/gif\",\"image\/png\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":11,"group":"config","key":"invoice_prefix","value":"INV-{{year}}-{{number}}","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":12,"group":"currency","key":"currency_auto","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":13,"group":"language","key":"list","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":14,"group":"language","key":"default","value":"th","title":"Default Front Language","desctiption":"Default Front Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":15,"group":"language","key":"admin","value":"th","title":"Default Admin Language","desctiption":"Default Admin Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":16,"group":"template","key":"admin","value":"default","title":"Default Front Template","desctiption":"Default Front Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":17,"group":"template","key":"front","value":"shindesign","title":"Default Admin Template","desctiption":"Default Admin Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":18,"group":"quota","key":"product_sku","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":19,"group":"quota","key":"pages","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":20,"group":"quota","key":"collection","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":21,"group":"quota","key":"category","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":22,"group":"currency","key":"default","value":"THB","title":"Default Currency","desctiption":"Default Currency","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":23,"group":"quota","key":"blogs","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":26,"group":"quota","key":"storage","value":"504748367","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":29,"group":"currency","key":"symbol","value":"\u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":31,"group":"paging","key":"product","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":32,"group":"paging","key":"category","value":"4","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":33,"group":"paging","key":"collection","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":34,"group":"language","key":"system","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":35,"group":"config","key":"timezone","value":"Asia\/Bangkok","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":37,"group":"config","key":"google_analytics","value":"","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":38,"group":"currency","key":"html_with_currency","value":"{{amount}} &#xe3f; THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":39,"group":"currency","key":"html_without_currency","value":"{{amount}} \u0e1a\u0e32\u0e17","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":40,"group":"currency","key":"email_with_currency","value":"{{amount}} \u0e3f THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":41,"group":"currency","key":"email_without_currency","value":"{{amount}} \u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":42,"group":"config","key":"price_hide_text","value":"Please contact shop","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":43,"group":"policy","key":"refund","value":"My Policy refund","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":44,"group":"policy","key":"privacy","value":"My policy privacy","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":45,"group":"policy","key":"terms","value":"My terms","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":46,"group":"unit","key":"length","value":"cm","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":47,"group":"unit","key":"system","value":"[\"metric\",\"imperial\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":48,"group":"unit","key":"default","value":"metric","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":49,"group":"unit","key":"weight","value":"kg","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":57,"group":"print","key":"receipt","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":58,"group":"print","key":"order","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":59,"group":"print","key":"tracking","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":60,"group":"quota","key":"language","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":61,"group":"quota","key":"promotion","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":62,"group":"print","key":"logo","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":64,"group":"print","key":"sender","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":65,"group":"print","key":"receiver","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":66,"group":"print","key":"showlogo","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":67,"group":"config","key":"prepare_shipping","value":"0","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":68,"group":"shipping","key":"instock","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":69,"group":"shipping","key":"preorder","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"}]';
        $mock = json_decode($mock);

        $this->storesettingRepository->expects($this->once())->method('getDefaultSetting')->will($this->returnValue($mock));

        $crawler = $this->client->request('GET', 'api/store/setting/111', array());
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testGetIndexSuccessCache()
    {
        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $data = '
{"status_code":0,"status_txt":"Success","data":{"benchmark":"false","record":{"config":{"upload_allowed":["image\/jpeg","image\/gif","image\/png"],"invoice_prefix":"INV-{{year}}-{{number}}","timezone":"Asia\/Bangkok","google_analytics":"","price_hide_text":"Please contact shop","prepare_shipping":"0"},"currency":{"currency_auto":"1","default":"THB","symbol":"\u0e3f","html_with_currency":"{{amount}} &#xe3f; THB","html_without_currency":"{{amount}} \u0e1a\u0e32\u0e17","email_with_currency":"{{amount}} \u0e3f THB","email_without_currency":"{{amount}} \u0e3f"},"language":{"list":["th"],"default":"th","admin":"th","system":["th"]},"template":{"admin":"default","front":"shindesign"},"quota":{"product_sku":"10","pages":"10","collection":"10","category":"10","blogs":"10","storage":"504748367","language":"10","promotion":"10"},"paging":{"product":"12","category":"4","collection":"12"},"policy":{"refund":"My Policy refund","privacy":"My policy privacy","terms":"My terms"},"unit":{"length":"cm","system":["metric","imperial"],"default":"metric","weight":"kg"},"print":{"receipt":"true","order":"true","tracking":"true","logo":"1","sender":"true","receiver":"true","showlogo":"true"},"shipping":{"instock":"1","preorder":"1"},"status_saved":0}}}';
        $this->cacheRepository->expects($this->once())->method('get')->will($this->returnValue($data));

        $crawler = $this->client->request('GET', 'api/store/setting/111');
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testCheckMethodInCaseHave()
    {
        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = '[{"store_id":111,"meta":"","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = json_decode($mock, true);

        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue($mock));

        $crawler = $this->client->request('GET', 'api/store/setting/111/check');
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('1', $json);
    }

    public function testCheckMethodInCaseNoHave()
    {
        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = null;
        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue($mock));

        $crawler = $this->client->request('GET', 'api/store/setting/111/check');
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('0', $json);
    }

    public function testStoreSettingInCaseHave()
    {

        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = '
[{"id":10,"group":"config","key":"upload_allowed","value":"[\"image\/jpeg\",\"image\/gif\",\"image\/png\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":11,"group":"config","key":"invoice_prefix","value":"INV-{{year}}-{{number}}","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":12,"group":"currency","key":"currency_auto","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":13,"group":"language","key":"list","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":14,"group":"language","key":"default","value":"th","title":"Default Front Language","desctiption":"Default Front Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":15,"group":"language","key":"admin","value":"th","title":"Default Admin Language","desctiption":"Default Admin Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":16,"group":"template","key":"admin","value":"default","title":"Default Front Template","desctiption":"Default Front Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":17,"group":"template","key":"front","value":"shindesign","title":"Default Admin Template","desctiption":"Default Admin Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":18,"group":"quota","key":"product_sku","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":19,"group":"quota","key":"pages","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":20,"group":"quota","key":"collection","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":21,"group":"quota","key":"category","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":22,"group":"currency","key":"default","value":"THB","title":"Default Currency","desctiption":"Default Currency","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":23,"group":"quota","key":"blogs","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":26,"group":"quota","key":"storage","value":"504748367","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":29,"group":"currency","key":"symbol","value":"\u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":31,"group":"paging","key":"product","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":32,"group":"paging","key":"category","value":"4","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":33,"group":"paging","key":"collection","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":34,"group":"language","key":"system","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":35,"group":"config","key":"timezone","value":"Asia\/Bangkok","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":37,"group":"config","key":"google_analytics","value":"","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":38,"group":"currency","key":"html_with_currency","value":"{{amount}} &#xe3f; THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":39,"group":"currency","key":"html_without_currency","value":"{{amount}} \u0e1a\u0e32\u0e17","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":40,"group":"currency","key":"email_with_currency","value":"{{amount}} \u0e3f THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":41,"group":"currency","key":"email_without_currency","value":"{{amount}} \u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":42,"group":"config","key":"price_hide_text","value":"Please contact shop","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":43,"group":"policy","key":"refund","value":"My Policy refund","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":44,"group":"policy","key":"privacy","value":"My policy privacy","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":45,"group":"policy","key":"terms","value":"My terms","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":46,"group":"unit","key":"length","value":"cm","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":47,"group":"unit","key":"system","value":"[\"metric\",\"imperial\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":48,"group":"unit","key":"default","value":"metric","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":49,"group":"unit","key":"weight","value":"kg","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":57,"group":"print","key":"receipt","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":58,"group":"print","key":"order","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":59,"group":"print","key":"tracking","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":60,"group":"quota","key":"language","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":61,"group":"quota","key":"promotion","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":62,"group":"print","key":"logo","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":64,"group":"print","key":"sender","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":65,"group":"print","key":"receiver","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":66,"group":"print","key":"showlogo","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":67,"group":"config","key":"prepare_shipping","value":"0","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":68,"group":"shipping","key":"instock","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":69,"group":"shipping","key":"preorder","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"}]';
        $mock = json_decode($mock);
        $this->storesettingRepository->expects($this->once())->method('getDefaultSetting')->will($this->returnValue($mock));

        $mock = '[{"store_id":111,"meta":"","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = json_decode($mock, true);
        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue($mock));

        $this->storesettingRepository->expects($this->once())->method('update')->will($this->returnValue(true));

        $this->cacheRepository->expects($this->any())->method('clear')->will($this->returnValue(true));

        $parameters = array();
        $crawler = $this->client->request('POST', 'api/store/setting/111', $parameters);
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testStoreSettingInCaseNoHave()
    {

        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = '
[{"id":10,"group":"config","key":"upload_allowed","value":"[\"image\/jpeg\",\"image\/gif\",\"image\/png\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":11,"group":"config","key":"invoice_prefix","value":"INV-{{year}}-{{number}}","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":12,"group":"currency","key":"currency_auto","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":13,"group":"language","key":"list","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":14,"group":"language","key":"default","value":"th","title":"Default Front Language","desctiption":"Default Front Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":15,"group":"language","key":"admin","value":"th","title":"Default Admin Language","desctiption":"Default Admin Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":16,"group":"template","key":"admin","value":"default","title":"Default Front Template","desctiption":"Default Front Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":17,"group":"template","key":"front","value":"shindesign","title":"Default Admin Template","desctiption":"Default Admin Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":18,"group":"quota","key":"product_sku","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":19,"group":"quota","key":"pages","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":20,"group":"quota","key":"collection","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":21,"group":"quota","key":"category","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":22,"group":"currency","key":"default","value":"THB","title":"Default Currency","desctiption":"Default Currency","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":23,"group":"quota","key":"blogs","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":26,"group":"quota","key":"storage","value":"504748367","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":29,"group":"currency","key":"symbol","value":"\u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":31,"group":"paging","key":"product","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":32,"group":"paging","key":"category","value":"4","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":33,"group":"paging","key":"collection","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":34,"group":"language","key":"system","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":35,"group":"config","key":"timezone","value":"Asia\/Bangkok","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":37,"group":"config","key":"google_analytics","value":"","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":38,"group":"currency","key":"html_with_currency","value":"{{amount}} &#xe3f; THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":39,"group":"currency","key":"html_without_currency","value":"{{amount}} \u0e1a\u0e32\u0e17","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":40,"group":"currency","key":"email_with_currency","value":"{{amount}} \u0e3f THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":41,"group":"currency","key":"email_without_currency","value":"{{amount}} \u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":42,"group":"config","key":"price_hide_text","value":"Please contact shop","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":43,"group":"policy","key":"refund","value":"My Policy refund","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":44,"group":"policy","key":"privacy","value":"My policy privacy","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":45,"group":"policy","key":"terms","value":"My terms","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":46,"group":"unit","key":"length","value":"cm","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":47,"group":"unit","key":"system","value":"[\"metric\",\"imperial\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":48,"group":"unit","key":"default","value":"metric","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":49,"group":"unit","key":"weight","value":"kg","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":57,"group":"print","key":"receipt","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":58,"group":"print","key":"order","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":59,"group":"print","key":"tracking","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":60,"group":"quota","key":"language","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":61,"group":"quota","key":"promotion","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":62,"group":"print","key":"logo","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":64,"group":"print","key":"sender","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":65,"group":"print","key":"receiver","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":66,"group":"print","key":"showlogo","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":67,"group":"config","key":"prepare_shipping","value":"0","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":68,"group":"shipping","key":"instock","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":69,"group":"shipping","key":"preorder","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"}]';
        $mock = json_decode($mock);
        $this->storesettingRepository->expects($this->once())->method('getDefaultSetting')->will($this->returnValue($mock));

        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue(null));
        $this->storesettingRepository->expects($this->once())->method('store')->will($this->returnValue(true));
        $this->cacheRepository->expects($this->any())->method('clear')->will($this->returnValue(true));

        $parameters = array();
        $crawler = $this->client->request('POST', 'api/store/setting/111', $parameters);
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testPutSettingTypeString()
    {

        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = '[{"store_id":111,"meta":"{\"config\":{\"upload_allowed\":[\"image\\\/jpeg\",\"image\\\/gif\",\"image\\\/png\"],\"invoice_prefix\":\"INV-{{year}}-{{number}}\",\"timezone\":\"Asia\\\/Bangkok\",\"google_analytics\":\"\",\"price_hide_text\":\"Please contact shop\",\"prepare_shipping\":\"0\"},\"currency\":{\"currency_auto\":\"1\",\"default\":\"THB\",\"symbol\":\"\\u0e3f\",\"html_with_currency\":\"{{amount}} &#xe3f; THB\",\"html_without_currency\":\"{{amount}} \\u0e1a\\u0e32\\u0e17\",\"email_with_currency\":\"{{amount}} \\u0e3f THB\",\"email_without_currency\":\"{{amount}} \\u0e3f\"},\"language\":{\"list\":[\"th\"],\"default\":\"th\",\"admin\":\"th\",\"system\":[\"th\"]},\"template\":{\"admin\":\"default\",\"front\":\"shindesign\"},\"quota\":{\"product_sku\":\"10\",\"pages\":\"10\",\"collection\":\"10\",\"category\":\"10\",\"blogs\":\"10\",\"storage\":\"504748367\",\"language\":\"10\",\"promotion\":\"10\"},\"paging\":{\"product\":\"12\",\"category\":\"4\",\"collection\":\"12\"},\"policy\":{\"refund\":\"My Policy refund\",\"privacy\":\"My policy privacy\",\"terms\":\"My terms\"},\"unit\":{\"length\":\"cm\",\"system\":[\"metric\",\"imperial\"],\"default\":\"metric\",\"weight\":\"kg\"},\"print\":{\"receipt\":\"true\",\"order\":\"true\",\"tracking\":\"true\",\"logo\":\"1\",\"sender\":\"true\",\"receiver\":\"true\",\"showlogo\":\"true\"},\"shipping\":{\"instock\":\"7\",\"preorder\":\"15\"}}","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = json_decode($mock, true);
        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue($mock));

        $this->storesettingRepository->expects($this->once())->method('update')->will($this->returnValue(true));

        $mock = '[{"store_id":111,"meta":"{\"config\":{\"upload_allowed\":[\"image\\\/jpeg\",\"image\\\/gif\",\"image\\\/png\"],\"invoice_prefix\":\"INV-{{year}}-{{number}}\",\"timezone\":\"Asia\\\/Bangkok\",\"google_analytics\":\"\",\"price_hide_text\":\"Please contact shop\",\"prepare_shipping\":\"0\"},\"currency\":{\"currency_auto\":\"1\",\"default\":\"THB\",\"symbol\":\"\\u0e3f\",\"html_with_currency\":\"{{amount}} &#xe3f; THB\",\"html_without_currency\":\"{{amount}} \\u0e1a\\u0e32\\u0e17\",\"email_with_currency\":\"{{amount}} \\u0e3f THB\",\"email_without_currency\":\"{{amount}} \\u0e3f\"},\"language\":{\"list\":[\"th\"],\"default\":\"th\",\"admin\":\"th\",\"system\":[\"th\"]},\"template\":{\"admin\":\"default\",\"front\":\"shindesign\"},\"quota\":{\"product_sku\":\"10\",\"pages\":\"10\",\"collection\":\"10\",\"category\":\"10\",\"blogs\":\"10\",\"storage\":\"504748367\",\"language\":\"10\",\"promotion\":\"10\"},\"paging\":{\"product\":\"12\",\"category\":\"4\",\"collection\":\"12\"},\"policy\":{\"refund\":\"My Policy refund\",\"privacy\":\"My policy privacy\",\"terms\":\"My terms\"},\"unit\":{\"length\":\"cm\",\"system\":[\"metric\",\"imperial\"],\"default\":\"metric\",\"weight\":\"kg\"},\"print\":{\"receipt\":\"true\",\"order\":\"true\",\"tracking\":\"true\",\"logo\":\"1\",\"sender\":\"true\",\"receiver\":\"true\",\"showlogo\":\"true\"},\"shipping\":{\"instock\":\"7\",\"preorder\":\"15\"}}","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = (object) json_decode($mock, true);
        $this->storesettingRepository->expects($this->once())->method('find')->will($this->returnValue($mock));

        $this->cacheRepository->expects($this->any())->method('clear')->will($this->returnValue(true));

        $parameters['shipping'] = 'a';
        $crawler = $this->client->request('PUT', 'api/store/setting/111', $parameters);
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testPutSetting()
    {

        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $mock = '[{"store_id":111,"meta":"{\"config\":{\"upload_allowed\":[\"image\\\/jpeg\",\"image\\\/gif\",\"image\\\/png\"],\"invoice_prefix\":\"INV-{{year}}-{{number}}\",\"timezone\":\"Asia\\\/Bangkok\",\"google_analytics\":\"\",\"price_hide_text\":\"Please contact shop\",\"prepare_shipping\":\"0\"},\"currency\":{\"currency_auto\":\"1\",\"default\":\"THB\",\"symbol\":\"\\u0e3f\",\"html_with_currency\":\"{{amount}} &#xe3f; THB\",\"html_without_currency\":\"{{amount}} \\u0e1a\\u0e32\\u0e17\",\"email_with_currency\":\"{{amount}} \\u0e3f THB\",\"email_without_currency\":\"{{amount}} \\u0e3f\"},\"language\":{\"list\":[\"th\"],\"default\":\"th\",\"admin\":\"th\",\"system\":[\"th\"]},\"template\":{\"admin\":\"default\",\"front\":\"shindesign\"},\"quota\":{\"product_sku\":\"10\",\"pages\":\"10\",\"collection\":\"10\",\"category\":\"10\",\"blogs\":\"10\",\"storage\":\"504748367\",\"language\":\"10\",\"promotion\":\"10\"},\"paging\":{\"product\":\"12\",\"category\":\"4\",\"collection\":\"12\"},\"policy\":{\"refund\":\"My Policy refund\",\"privacy\":\"My policy privacy\",\"terms\":\"My terms\"},\"unit\":{\"length\":\"cm\",\"system\":[\"metric\",\"imperial\"],\"default\":\"metric\",\"weight\":\"kg\"},\"print\":{\"receipt\":\"true\",\"order\":\"true\",\"tracking\":\"true\",\"logo\":\"1\",\"sender\":\"true\",\"receiver\":\"true\",\"showlogo\":\"true\"},\"shipping\":{\"instock\":\"7\",\"preorder\":\"15\"}}","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = json_decode($mock, true);
        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue($mock));

        $this->storesettingRepository->expects($this->once())->method('update')->will($this->returnValue(true));

        $mock = '[{"store_id":111,"meta":"{\"config\":{\"upload_allowed\":[\"image\\\/jpeg\",\"image\\\/gif\",\"image\\\/png\"],\"invoice_prefix\":\"INV-{{year}}-{{number}}\",\"timezone\":\"Asia\\\/Bangkok\",\"google_analytics\":\"\",\"price_hide_text\":\"Please contact shop\",\"prepare_shipping\":\"0\"},\"currency\":{\"currency_auto\":\"1\",\"default\":\"THB\",\"symbol\":\"\\u0e3f\",\"html_with_currency\":\"{{amount}} &#xe3f; THB\",\"html_without_currency\":\"{{amount}} \\u0e1a\\u0e32\\u0e17\",\"email_with_currency\":\"{{amount}} \\u0e3f THB\",\"email_without_currency\":\"{{amount}} \\u0e3f\"},\"language\":{\"list\":[\"th\"],\"default\":\"th\",\"admin\":\"th\",\"system\":[\"th\"]},\"template\":{\"admin\":\"default\",\"front\":\"shindesign\"},\"quota\":{\"product_sku\":\"10\",\"pages\":\"10\",\"collection\":\"10\",\"category\":\"10\",\"blogs\":\"10\",\"storage\":\"504748367\",\"language\":\"10\",\"promotion\":\"10\"},\"paging\":{\"product\":\"12\",\"category\":\"4\",\"collection\":\"12\"},\"policy\":{\"refund\":\"My Policy refund\",\"privacy\":\"My policy privacy\",\"terms\":\"My terms\"},\"unit\":{\"length\":\"cm\",\"system\":[\"metric\",\"imperial\"],\"default\":\"metric\",\"weight\":\"kg\"},\"print\":{\"receipt\":\"true\",\"order\":\"true\",\"tracking\":\"true\",\"logo\":\"1\",\"sender\":\"true\",\"receiver\":\"true\",\"showlogo\":\"true\"},\"shipping\":{\"instock\":\"7\",\"preorder\":\"15\"}}","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = (object) json_decode($mock, true);
        $this->storesettingRepository->expects($this->once())->method('find')->will($this->returnValue($mock));

        $this->cacheRepository->expects($this->any())->method('clear')->will($this->returnValue(true));

        $parameters['shipping']['instock'] = 5;
        $parameters['shipping']['preorder'] = 15;
        $crawler = $this->client->request('PUT', 'api/store/setting/111', $parameters);
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testPutSettingNoHave()
    {

        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $this->storesettingRepository->expects($this->once())->method('getSetting')->will($this->returnValue(null));

        $mock = '[{"id":10,"group":"config","key":"upload_allowed","value":"[\"image\/jpeg\",\"image\/gif\",\"image\/png\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":11,"group":"config","key":"invoice_prefix","value":"INV-{{year}}-{{number}}","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":12,"group":"currency","key":"currency_auto","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":13,"group":"language","key":"list","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":14,"group":"language","key":"default","value":"th","title":"Default Front Language","desctiption":"Default Front Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":15,"group":"language","key":"admin","value":"th","title":"Default Admin Language","desctiption":"Default Admin Language","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":16,"group":"template","key":"admin","value":"default","title":"Default Front Template","desctiption":"Default Front Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":17,"group":"template","key":"front","value":"shindesign","title":"Default Admin Template","desctiption":"Default Admin Template","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":18,"group":"quota","key":"product_sku","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":19,"group":"quota","key":"pages","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":20,"group":"quota","key":"collection","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":21,"group":"quota","key":"category","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":22,"group":"currency","key":"default","value":"THB","title":"Default Currency","desctiption":"Default Currency","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":23,"group":"quota","key":"blogs","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"2013-08-19 01:22:16","updated_at":"2013-08-19 01:22:16"},{"id":26,"group":"quota","key":"storage","value":"504748367","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":29,"group":"currency","key":"symbol","value":"\u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":31,"group":"paging","key":"product","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":32,"group":"paging","key":"category","value":"4","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":33,"group":"paging","key":"collection","value":"12","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":34,"group":"language","key":"system","value":"[\"th\"]","title":"","desctiption":"","serialized":1,"status":2,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":35,"group":"config","key":"timezone","value":"Asia\/Bangkok","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":37,"group":"config","key":"google_analytics","value":"","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":38,"group":"currency","key":"html_with_currency","value":"{{amount}}  THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":39,"group":"currency","key":"html_without_currency","value":"{{amount}} \u0e1a\u0e32\u0e17","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":40,"group":"currency","key":"email_with_currency","value":"{{amount}} \u0e3f THB","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":41,"group":"currency","key":"email_without_currency","value":"{{amount}} \u0e3f","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":42,"group":"config","key":"price_hide_text","value":"Please contact shop","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":43,"group":"policy","key":"refund","value":"My Policy refund","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":44,"group":"policy","key":"privacy","value":"My policy privacy","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":45,"group":"policy","key":"terms","value":"My terms","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":46,"group":"unit","key":"length","value":"cm","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":47,"group":"unit","key":"system","value":"[\"metric\",\"imperial\"]","title":"","desctiption":"","serialized":1,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":48,"group":"unit","key":"default","value":"metric","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":49,"group":"unit","key":"weight","value":"kg","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":57,"group":"print","key":"receipt","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":58,"group":"print","key":"order","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":59,"group":"print","key":"tracking","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":60,"group":"quota","key":"language","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":61,"group":"quota","key":"promotion","value":"10","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":62,"group":"print","key":"logo","value":"1","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":64,"group":"print","key":"sender","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":65,"group":"print","key":"receiver","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":66,"group":"print","key":"showlogo","value":"true","title":"","desctiption":"","serialized":0,"status":1,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":67,"group":"config","key":"prepare_shipping","value":"0","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":68,"group":"shipping","key":"instock","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"},{"id":69,"group":"shipping","key":"preorder","value":"1","title":"","desctiption":"","serialized":0,"status":0,"created_at":"-0001-11-30 00:00:00","updated_at":"-0001-11-30 00:00:00"}]';
        $mock = json_decode($mock);
        $this->storesettingRepository->expects($this->once())->method('getSettingAll')->will($this->returnValue($mock));

        $this->storesettingRepository->expects($this->once())->method('store')->will($this->returnValue(true));

        $mock = '[{"store_id":111,"meta":"{\"config\":{\"upload_allowed\":[\"image\\\/jpeg\",\"image\\\/gif\",\"image\\\/png\"],\"invoice_prefix\":\"INV-{{year}}-{{number}}\",\"timezone\":\"Asia\\\/Bangkok\",\"google_analytics\":\"\",\"price_hide_text\":\"Please contact shop\",\"prepare_shipping\":\"0\"},\"currency\":{\"currency_auto\":\"1\",\"default\":\"THB\",\"symbol\":\"\\u0e3f\",\"html_with_currency\":\"{{amount}} &#xe3f; THB\",\"html_without_currency\":\"{{amount}} \\u0e1a\\u0e32\\u0e17\",\"email_with_currency\":\"{{amount}} \\u0e3f THB\",\"email_without_currency\":\"{{amount}} \\u0e3f\"},\"language\":{\"list\":[\"th\"],\"default\":\"th\",\"admin\":\"th\",\"system\":[\"th\"]},\"template\":{\"admin\":\"default\",\"front\":\"shindesign\"},\"quota\":{\"product_sku\":\"10\",\"pages\":\"10\",\"collection\":\"10\",\"category\":\"10\",\"blogs\":\"10\",\"storage\":\"504748367\",\"language\":\"10\",\"promotion\":\"10\"},\"paging\":{\"product\":\"12\",\"category\":\"4\",\"collection\":\"12\"},\"policy\":{\"refund\":\"My Policy refund\",\"privacy\":\"My policy privacy\",\"terms\":\"My terms\"},\"unit\":{\"length\":\"cm\",\"system\":[\"metric\",\"imperial\"],\"default\":\"metric\",\"weight\":\"kg\"},\"print\":{\"receipt\":\"true\",\"order\":\"true\",\"tracking\":\"true\",\"logo\":\"1\",\"sender\":\"true\",\"receiver\":\"true\",\"showlogo\":\"true\"},\"shipping\":{\"instock\":\"7\",\"preorder\":\"15\"}}","updated_by":0,"created_at":"2014-11-07 15:33:20","updated_at":"2014-11-07 15:38:52"}]';
        $mock = (object) json_decode($mock, true);
        $this->storesettingRepository->expects($this->once())->method('find')->will($this->returnValue($mock));

        $this->cacheRepository->expects($this->any())->method('clear')->will($this->returnValue(true));

        $parameters['shipping']['instock'] = 5;
        $parameters['shipping']['preorder'] = 15;
        $crawler = $this->client->request('PUT', 'api/store/setting/111', $parameters);
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    public function testPutInvalidParameter()
    {

        $crawler = $this->client->request('PUT','api/store/setting/xxx');
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":1003', $json);

    }

    // delete
    public function testDeleteSuccess()
    {
        $this->cacheRepository = $this->getMock('CachedRepository');
        $this->app->instance('CachedRepository', $this->cacheRepository);

        $this->storesettingRepository = $this->getMock('StoreSettingRepository');
        $this->app->instance('StoreSettingRepository', $this->storesettingRepository);

        $this->storesettingRepository->expects($this->once())->method('delete')->will($this->returnValue(true));

        $this->cacheRepository->expects($this->any())->method('clear')->will($this->returnValue(true));

        $crawler = $this->client->request('DELETE','api/store/setting/111');
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":0', $json);
        $this->assertContains('"status_txt":"Success"', $json);

    }

    // delete
    public function testDeleteInvalidParameter()
    {

        $crawler = $this->client->request('DELETE','api/store/setting/xxx');
        $json = $this->client->getResponse()->getContent();

        $this->assertTrue($this->client->getResponse()->isOk());
        $this->assertContains('"status_code":1003', $json);

    }

}
